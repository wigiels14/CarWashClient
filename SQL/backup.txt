DROP TABLE SERVICE_CAR_STATION_EMPLOYEES;
DROP TABLE SERVICE_DISCOUNTS;
DROP TABLE SERVICE_ORDERS;
DROP TABLE SERVICE;
DROP TABLE CUSTMER_DISCOUNTS;
DROP TABLE DISCOUNT;
DROP TABLE REMMITANCE;
DROP TABLE ORDERS;
DROP TABLE PAYMENT;
DROP TABLE VEHICLE;
DROP TABLE CAR_STATION_EMPLOYEE;
DROP TABLE CUSTOMER;

CREATE TABLE CUSTOMER(
ID NUMERIC(10) NOT NULL PRIMARY KEY,
CUSTOMER_PASSWORD VARCHAR(30) NOT NULL,
FIRST_NAME VARCHAR(30),
LAST_NAME VARCHAR(30),
PESEL VARCHAR(11) NOT NULL,
ID_NUMBER VARCHAR(9) NOT NULL,
ACCOUNT_BALLANCE NUMERIC(10) NOT NULL
);

CREATE TABLE CAR_STATION_EMPLOYEE(
ID NUMERIC(10) NOT NULL PRIMARY KEY,
CAR_STATION_EMPLOYEE_PASSWORD VARCHAR(30) NOT NULL,
FIRST_NAME VARCHAR(30) NOT NULL,
LAST_NAME VARCHAR(30) NOT NULL,
PESEL VARCHAR(11) NOT NULL,
ID_NUMBER VARCHAR(9) NOT NULL
);

CREATE TABLE VEHICLE(
ID NUMERIC(10) NOT NULL PRIMARY KEY,
MARK VARCHAR(30) NOT NULL,
MODEL VARCHAR(30) NOT NULL,
CUSTOMER_ID NUMERIC(10) REFERENCES CUSTOMER(ID)
);

CREATE TABLE PAYMENT(
ID NUMERIC(10) NOT NULL PRIMARY KEY
);

CREATE TABLE ORDERS(
ID NUMERIC(10) NOT NULL PRIMARY KEY,
PAYMENT_ID NUMERIC(10) REFERENCES PAYMENT(ID),
VEHICLE_ID NUMERIC(10) REFERENCES VEHICLE(ID),
STATE VARCHAR(30) NOT NULL
);

CREATE TABLE REMMITANCE(
ID NUMERIC(10) NOT NULL PRIMARY KEY,
ORDERS_ID NUMERIC(10) REFERENCES ORDERS(ID)
);

CREATE TABLE DISCOUNT(
ID NUMERIC(10) NOT NULL PRIMARY KEY,
AMOUNT NUMERIC(5) NOT NULL,
DESCRIPTION VARCHAR(100) NOT NULL
);

CREATE TABLE CUSTMER_DISCOUNTS(
CUSTMER_ID NUMERIC(10) REFERENCES CUSTOMER(ID),
DISCOUNT_ID NUMERIC(10) REFERENCES DISCOUNT(ID),
PRIMARY KEY(CUSTMER_ID, DISCOUNT_ID)
);

CREATE TABLE SERVICE(
ID NUMERIC(10) NOT NULL PRIMARY KEY
);

CREATE TABLE SERVICE_ORDERS(
SERVICE_ID NUMERIC(10) NOT NULL REFERENCES SERVICE(ID),
ORDER_ID NUMERIC(10) NOT NULL REFERENCES ORDERS(ID),
PRIMARY KEY(SERVICE_ID, ORDER_ID)
);

CREATE TABLE SERVICE_DISCOUNTS(
SERVICE_ID NUMERIC(10) NOT NULL REFERENCES SERVICE(ID),
DISCOUNT_ID NUMERIC(10) NOT NULL REFERENCES DISCOUNT(ID),
PRIMARY KEY(SERVICE_ID, DISCOUNT_ID)
);

CREATE TABLE SERVICE_CAR_STATION_EMPLOYEES(
SERVICE_ID NUMERIC(10) NOT NULL REFERENCES SERVICE(ID),
CAR_STATION_EMPLOYEE_ID NUMERIC(10) NOT NULL REFERENCES CAR_STATION_EMPLOYEE(ID),
PRIMARY KEY(SERVICE_ID, CAR_STATION_EMPLOYEE_ID)
);

DROP SEQUENCE customer_sequence;
DROP SEQUENCE car_wash_employee_sequence;
DROP SEQUENCE order_sequence;
DROP SEQUENCE service_sequence;
DROP SEQUENCE vehicle_sequence;
DROP SEQUENCE payment_sequence;
DROP SEQUENCE remmitance_sequence;
DROP SEQUENCE discount_sequence;

CREATE SEQUENCE customer_sequence;
CREATE SEQUENCE car_wash_employee_sequence;
CREATE SEQUENCE service_sequence;
CREATE SEQUENCE order_sequence;
CREATE SEQUENCE vehicle_sequence;
CREATE SEQUENCE payment_sequence;
CREATE SEQUENCE remmitance_sequence;
CREATE SEQUENCE discount_sequence;
  
DROP FUNCTION create_customer(idNumber IN VARCHAR,pesel IN VARCHAR,customer_password IN VARCHAR);
CREATE FUNCTION create_customer(idNumber IN VARCHAR,pesel IN VARCHAR,customer_password IN VARCHAR)
RETURNS void AS $$
BEGIN
    INSERT INTO CUSTOMER(ID, CUSTOMER_PASSWORD, PESEL, ID_NUMBER, ACCOUNT_BALLANCE)
    VALUES(nextval('customer_sequence'), customer_password, pesel, idNumber, 0);
END; 
$$ LANGUAGE plpgsql;

DO $$ BEGIN
    PERFORM create_customer('2','3','1');
END $$;

SELECT * FROM CUSTOMER;

 INSERT INTO CAR_STATION_EMPLOYEE(ID, CAR_STATION_EMPLOYEE_PASSWORD, FIRST_NAME, PESEL, ID_NUMBER, LAST_NAME)
 VALUES(nextval('customer_sequence'), '55', '55', '55', '55', '55');